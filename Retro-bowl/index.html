<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Generated by GameMaker:Studio http://www.yoyogames.com/gamemaker/studio -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="pragma" content="no-cache" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta charset="utf-8" />
    <!-- Set the title bar of the page -->
    <title>Retro Bowl</title>
    <!-- Set the background colour of the document -->
    <style>
        body {
            background: #000;
            color: #cccccc;
            margin: 0px;
            padding: 0px;
            border: 0px;
        }

        canvas {
            image-rendering: optimizeSpeed;
            -webkit-interpolation-mode: nearest-neighbor;
            -ms-touch-action: none;
            margin: 0px;
            padding: 0px;
            border: 0px;
        }

        :-webkit-full-screen #canvas {
            width: 100%;
            height: 100%;
        }

        div.gm4html5_div_class {
            margin: 0px;
            padding: 0px;
            border: 0px;
        }

        /* START - Login Dialog Box */
        div.gm4html5_login {
            padding: 20px;
            position: absolute;
            border: solid 2px #000000;
            background-color: #404040;
            color: #00ff00;
            border-radius: 15px;
            box-shadow: #101010 20px 20px 40px;
        }

        div.gm4html5_cancel_button {
            float: right;
        }

        div.gm4html5_login_button {
            float: left;
        }

        div.gm4html5_login_header {
            text-align: center;
        }

        /* END - Login Dialog Box */
        :-webkit-full-screen {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
<div class="gm4html5_div_class" id="gm4html5_div_id">
    <img src="html5game/splash.png" id="GM4HTML5_loadingscreen" alt="GameMaker:HTML5 loading screen" style="display: none;" />
    <!-- Create the canvas element the game draws to -->
    <canvas id="canvas" width="960" height="540">
        <p>Your browser doesn't support HTML5 canvas.</p>
    </canvas>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.9.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.9.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.9.0/firebase-firestore.js"></script>

<script>
    // Initialize Firebase
    var firebaseConfig = {
        apiKey: "AIzaSyBaqyCHImGihZNe5B-_7woiKMkutwXgvVA",
        authDomain: "retro--bowl.firebaseapp.com",
        projectId: "retro--bowl",
        storageBucket: "retro--bowl.appspot.com",
        messagingSenderId: "G-EKXPQBZHV3",
        appId: "1:963161813343:web:83baea5e7bab6f7983c6ea"
    };
    firebase.initializeApp(firebaseConfig);

    // Firebase Firestore instance
    var firestore = firebase.firestore();

    // Function to save game progress to Firestore
    function saveGameProgress(userId, data) {
        firestore.collection("gameProgress").doc(userId).set({
            data: data
        })
            .then(function() {
                console.log("Game progress saved successfully");
            })
            .catch(function(error) {
                console.error("Error saving game progress: ", error);
            });
    }

    // Function to load game progress from Firestore
    function loadGameProgress(userId) {
        firestore.collection("gameProgress").doc(userId).get()
            .then(function(doc) {
                if (doc.exists) {
                    var data = doc.data().data;
                    LoadGameFromFirestore(data);
                } else {
                    console.log("No game progress found");
                }
            })
            .catch(function(error) {
                console.error("Error getting game progress: ", error);
            });
    }

    window.onload = function() {
        // Run the game initialization
        GameMaker_Init();

        // Listen for authentication state changes
        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
                // User is signed in
                var userId = user.uid;
                loadGameProgress(userId);
            } else {
                // No user is signed in
                console.log("No user signed in");
            }
        });
    };

    // Function to load game data from Firestore
    function LoadGameFromFirestore(data) {
        // Implement loading game data and updating game state here
        // For simplicity, let's assume we directly update the gameData object
        gameData = data;
    }
</script>

<!-- Run the game code -->
<script type="text/javascript" src="html5game/RetroBowl.js?WAEAC=1633155445"></script>
    <!-- Login and Signup buttons -->
<div style="position: absolute; top: 20px; right: 20px;">
    <button class="button" onclick="login()">Login</button>
    <button class="button" onclick="signup()">Sign Up</button>
</div>

<script>
    <script>
    function login() {
        // Implement login functionality
        // Example:
        // var provider = new firebase.auth.GoogleAuthProvider();
        // firebase.auth().signInWithPopup(provider);
    }

    function signup() {
        // Implement signup functionality
        // Example:
        // var provider = new firebase.auth.GoogleAuthProvider();
        // firebase.auth().signInWithPopup(provider);
    }
</script>
</body>
</html>
